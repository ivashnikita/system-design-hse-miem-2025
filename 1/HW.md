# Домашка

1. Нажать “Do one!” на этом сайте: [architecturalkatas.com](https://www.architecturalkatas.com/)
2. Ознакомиться с вводными
3. Целиком пройти этап **«Сбор и анализ требований»**:
    - Отсев
    - Scope Refinement
    - Функциональные требования
    - Нефункциональные требования
    - Ограничения
    - Расчет нагрузки:
        * Трафик
        * БД
4. Сформировать отчет по правилам ниже

*Доп. вводные:*  
Вы находитесь в России, 2025 год.

---

## Формат сдачи
1. Форкнуть репу к себе
2. Сделать собственную ветку
3. ДЗ оформить в `.md` файл и запушить
4. Сделать мердж-реквест в `master` и поставить меня в **Reviewer** (@nikolaysavelev)

**Дедлайн:** 2 недели (26.04)

# Выполнение 

## Полученное условие 
Agile Dead Trees  
A publisher wants to unify its authoring CMS and customer store experience

Users: dozens of publisher employees, hundreds of authors, thousands/millions of customers

Requirements: authors publish chapters; reviewers see the chapters, make review comments, and notify authors on review; authors can reject proposed review changes; customers can buy books (either e- form or dead trees form) online, including those available in "beta"; publisher can push authors' chapters to those customers who bought the "beta"

## Решение

## 1. **Отсев требований**
### Ключевые вопросы для стейкхолдеров:
- **Железность требований**:
   - Что произойдет, если не реализовать интеграцию CMS и магазина?  
     *Ответ*: Потеря связности между авторами и клиентами, дублирование данных, рост операционных затрат, ограничение на ввод нового функционала 
   - Как измерить успех?  
     *Метрики*: Увеличение конверсии продаж бета-книг на 30%, сокращение времени публикации на 50%. 

- **Ресурсы**:
   - Бюджет: Ограничен 15 млн руб. на первый этап.
   - Инфраструктура: Требуется миграция с legacy-систем на российские облака.

- **Реалистичность**:
   - Санкционные ограничения 2025: Использование только отечественных технологий, поддерживаемые российскими облаками (PostgreSQL, ClickHouse и тд.)

### Итог:
- **Включено**: Интеграция CMS и магазина, механика бета-доступа, базовые workflow рецензирования.
- **Исключено**: Мультиязычность (на старте), интеграция с зарубежными платежными системами, использование иностранных систем

---

## 2. **Scope Refinement**

### **Пользователи:**
1. **Авторы** (сотни):
   - Публикуют главы, управляют версиями, взаимодействуют с рецензентами.
2. **Рецензенты** (сотни):
   - Проверяют главы, оставляют комментарии, контролируют качество контента.
3. **Клиенты** (тысячи / миллионы):
   - Покупают книги (электронные / бумажные), получают бета-обновления.
4. **Администраторы издательства** (десятки):
   - Управляют каталогом книг, настраивают правила публикации, контролируют процессы.

---

### **Основные функции:**

### 1. **Для авторов:**
- **Публикация глав**:  
  Загрузка глав в форматах DOCX / PDF, сохранение черновиков, управление версиями.
- **Работа с правками**:  
  Просмотр комментариев рецензентов, принятие / отклонение изменений с аргументацией.

### 2. **Для рецензентов:**
- **Оценка контента**:  
  Комментирование текста с привязкой к абзацам, тегирование замечаний (стиль, факты, грамматика).
- **Уведомления**:  
  Система оповещений о новых главах для проверки и ответах авторов.

### 3. **Для клиентов:**
- **Покупка книг**:  
  Выбор формата (электронная книга / бумажная версия), оплата онлайн, доступ к бета-контенту.
- **Получение обновлений**:  
  Автоматическая доставка новых глав бета-книг через сервис (веб-сервис или мобильное приложение (PWA)).

### 4. **Для администраторов:**
- **Управление каталогом**:  
  Добавление / удаление и ограничение книг, настройка параметров бета-доступа, контроль цен.
- **Модерация процессов**:  
  Назначение рецензентов, разрешение конфликтов между авторами и рецензентами.

---

### **Дополнительные функции:**

### 1. **Интеграции:**
- **Партнерские магазины**:  
  Синхронизация каталога с агрегаторами для расширения аудитории.
- **Почтовые сервисы**:  
  Интеграция с почтой (физически и с сервисами почты) для отслеживания доставки бумажных книг.

### 2. **Финансовые операции:**
- **Генерация электронных чеков**:  
  Автоматическая отправка чеков клиентам после покупки через email и CRM.
- **Роялти для авторов**:  
  Система расчета и выплаты вознаграждений авторам на основе продаж.

### 3. **Аналитика:**
- **Дашборды для издательства**:  
  Визуализация метрик: конверсия бета-покупок, среднее время рецензирования, топ авторов.
- **Рекомендательная система**:  
  Персональные рекомендации книг для клиентов на основе истории покупок.

---

### Архитектурные компоненты:
| Модуль                      | Функционал                                                                 |
|-----------------------------|----------------------------------------------------------------------------|
| **Авторский портал**        | Загрузка глав (DOCX/PDF), управление версиями, история отклонений правок   |
| **Рецензирование**          | Комментирование с привязкой к тексту, SLA на ответ автора (72 часа)        |
| **Магазин**                 | Продажа книг с фильтром "бета-доступ", доставка бумажных книг через почту  |
| **Административная панель** | Ролевая модель (автор/рецензент/клиент), аналитика продаж в BI-инструменте |

---

## 3. **Функциональные требования**

### **Акторы**
- **Автор**: Создает и публикует главы, управляет версиями, взаимодействует с рецензентами.
- **Рецензент**: Проверяет главы, оставляет комментарии, уведомляет авторов о замечаниях.
- **Клиент**: Покупает книги (электронные / бумажные), получает бета-версии книг.
- **Администратор издательства**: Управляет каталогом книг, настраивает правила публикации и доступа.
- **Партнеры (агрегаторы)**: Интегрируются с системой для перепродажи книг.

---

### **Домен, бизнес-процессы**

### **Домен**
Система работает в области издательского дела и электронной коммерции, объединяя:
- **Управление контентом (CMS)** для авторов и рецензентов.
- **Онлайн-магазин** для продажи книг клиентам.

### **Данные**
- **Книги**: Название, жанр, цена, статус (бета/релиз), список глав.
- **Главы**: Текст, версия, статус (черновик/опубликовано), история изменений.
- **Рецензии**: Комментарии, теги (стиль, грамматика), статус (принято/отклонено).
- **Транзакции**: ID покупки, формат книги (PDF/бумажная), данные доставки.

### **Бизнес-процессы**
1. **Публикация главы**:  
   Автор → загружает главу → система назначает рецензента → рецензент проверяет → автор вносит правки → глава публикуется.
2. **Продажа бета-книги**:  
   Клиент → выбирает книгу → оплачивает → получает доступ к текущим главам → автоматические обновления при выходе новых глав.
3. **Арбитраж конфликтов**:  
   При отклонении правок автором → администратор принимает окончательное решение.

---

### **Основные функции**

### **Базовые функции (MVP):**
1. **Для авторов**:
   - Загрузка глав в форматах DOCX/PDF.
   - Просмотр комментариев рецензентов с возможностью принятия/отклонения.
2. **Для рецензентов**:
   - Комментирование текста с привязкой к абзацам.
   - Уведомления о новых главах через сервис.
3. **Для клиентов**:
   - Покупка книг с выбором формата (электронный/бумажный).
   - Получение новых глав бета-книг автоматически после оплаты.
4. **Для администраторов**:
   - Управление каталогом книг (добавление/удаление).
   - Настройка правил бета-доступа (например, ограничение по регионам).

### **Примеры функций:**
- **Версионность глав**: Возможность отката к предыдущей версии текста.
- **Трекинг доставки**: Интеграция с почтой для отслеживания бумажных книг.

---

### **Специфические сценарии использования**

### **Специфические сценарии:**
1. **Конфликт при рецензировании**:
   - Автор отклоняет все правки рецензента → система уведомляет администратора → арбитраж → фиксация итогового решения.
2. **Срочная публикация главы**:
   - Администратор вручную запускает доставку новой главы всем бета-клиентам, минуя очередь рецензирования.
3. **Обработка поврежденных бумажных книг**:
   - Клиент сообщает о повреждении → система автоматически формирует заказ на повторную печать за счет страховки.

### **Корнер-кейсы:**
- **Клиент не получил электронную книгу**:  
  Проверка очереди сообщений → повторная отправка + уведомление в поддержку.
- **Рецензент не завершил проверку в срок**:  
  Система автоматически переназначает главу другому рецензенту.

---

### **User Stories:**
1. **Как автор, я хочу**:
   - Отклонять правки рецензентов с комментарием, чтобы сохранить авторский стиль.  
     *Критерии принятия*: История отклонений доступна в логе, уведомление рецензенту в течение 5 мин.

2. **Как клиент, я хочу**:
   - Получать новые главы бета-книг автоматически, чтобы не проверять обновления вручную.  
     *Критерии*: Push-уведомление в мобильное приложение (PWA), веб-версию.

3. **Как рецензент, я хочу**:
   - Видеть очередь глав для проверки с приоритетом "срочно", чтобы соблюдать сроки издательства.

---

## 4. **Нефункциональные требования**

### **1. Производительность**
- **Стандартная нагрузка**:
   - 10 000 одновременных пользователей в магазине.
   - 500 авторов/рецензентов, работающих с CMS.
- **Пиковая нагрузка** (релиз новой главы / распродажа):
   - До 100 000 одновременных сессий в магазине.
   - Время отклика API: < 2 сек для 95% запросов.
- **Обработка данных**:
   - Загрузка главы (~5 МБ) → обработка за < 10 сек.

### **2. Масштабируемость**
- **Горизонтальное масштабирование**:
   - Автоматическое добавление реплик при росте нагрузки (менеджер от облака).
- **База данных**:
   - Шардинг по жанрам книг для распределения нагрузки. 
   - Поддержка до 10 млн транзакций в месяц.

### **3. Отказоустойчивость**
- **Резервирование**:
   - Репликация БД в реальном времени (синхронная + асинхронная).
- **Восстановление**:
   - RTO (Recovery Time Objective) < 15 мин.
   - RPO (Recovery Point Objective) < 5 мин.

### **4. Безопасность**
- **Данные**:
   - Шифрование персональных данных.
   - Соответствие СТО БР ИББС для платежных операций.
- **Доступ**:
   - 2FA для авторов и администраторов.
   - Ролевая модель (RBAC) с минимальными привилегиями.
- **Контент**:
   - Защита от DDoS-атак.

### **5. Мониторинг**
- **Метрики**:
   - Отслеживание RPS, latency, ошибок 5xx/4xx.
   - Логирование действий администраторов.
- **Инструменты**:
   - Prometheus + Grafana для сбора метрик.
   - Sentry для обработки исключений.
- **Оповещения**:
   - Telegram-боты при превышении пороговых значений.

### **6. Регуляторные требования**
- **ФЗ-152**: Хранение персданных клиентов только на серверах в РФ.
- **ФЗ-54**: Интеграция с ОФД для электронных чеков.
- **Импортозамещение**:
   - Отечественные облака.

### **7. Переносимость и совместимость**
- **Браузеры**: Яндекс.Браузер, Chrome, Safari.
- **Мобильные устройства**: Адаптивный дизайн (использование PWA).
- **API**:
   - Совместимость с OpenAPI 3.0 для интеграции с агрегаторами.
   - Поддержка форматов JSON и XML.

### **8. Пользовательский опыт**
- **Интерфейс**:
   - Время загрузки страницы < 3 сек.
   - Прогрессивный рендеринг для каталога книг.
- **Доступность**:
   - Соответствие стандарту WCAG 2.1 (уровень AA).
   - Поддержка screen readers.
- **Удобство**:
   - Однокликовая покупка для зарегистрированных пользователей.
   - Автосохранение черновиков глав каждые 5 мин.

---

## 5. **Ограничения**

### **1. Бизнес-модель**
- **B2B**: Взаимодействие с авторами и издательствами (сотрудничество по публикациям).
- **B2C**: Продажа книг конечным клиентам через онлайн-магазин.

---

### **2. Основные бизнес-метрики**
- **DAU/MAU**:
   - DAU: 50k (клиенты) / 500 (авторы).
   - MAU: 1.5 млн (клиенты) / 5k (авторы).
- **Retention**:
   - 30% клиентов возвращаются для покупки бета-книг.
- **ROI**:
   - Окупаемость платформы за 2 года.

---

### **3. География пользователей**
- **Основная**: Россия (85%).
- **Дополнительная**: СНГ (10%), русскоязычные пользователи за рубежом (5%).

---

### **4. Специфика домена**
- **Екоммерс**: Продажа книг, интеграция с платежными системами.
- **Контент-менеджмент**: Управление версиями глав, рецензирование.

---

### **5. Тип устройств**
- **Браузер**: Основной интерфейс для авторов и рецензентов (Chrome, Яндекс.Браузер, Safari).
- **Мобильные устройства**: 70% клиентов используют смартфоны для покупок.

---

### **6. Этап развития**
- **MVP**:
   - Базовая интеграция CMS и магазина.
   - Возможность клиентами покупать доступ к бета-версии книг напрямую.

---

### **7. Тип развертывания**
- **Cloud**: Российские облака, соблюдающие законодательство РФ
- **On-Premise**: Только для резервных копий.

---

### **8. Время разработки**
- **Срок**: 12 месяцев (MVP).
- **Этапы**:
   - 6 месяца — ядро CMS + магазин.
   - 6 месяцев — интеграция бета-доставки.

---

### **9. Бюджет на технологии**
- **Общий**: 15 млн руб.
- **Распределение**:
   - 40% — разработка.
   - 30% — облачная инфраструктура.
   - 30% — интеграции.

---

### **10. Технологии**
- **Стек**:
   - Бэкенд: Java (Spring), PostgreSQL.
   - Фронтенд: React + TypeScript.
- **Импортозамещение**:
   - Замена GitHub → GitLab.
   - СУБД: PostgreSQL.

---

### **11. Существующие сервисы**
- **Legacy-системы**:
   - Устаревшая CMS издательства (миграция данных).
   - Платформа для доставки бумажных книг (интеграция через API).

---

### **12. Бюджет на железо**
- **Серверы**: 5 млн руб./год (российские решения).
- **Резервирование**: 20% бюджета на страховые случаи.

---

### **13. SLA**
- **Доступность**: 99.9% (исключая плановое обслуживание).
- **Производительность**:
   - Загрузка страницы магазина < 3 сек.
   - Обработка платежа < 5 сек.

---

### **14. Регуляторные требования**
- **ФЗ-152**: Хранение персданных клиентов в РФ.
- **ФЗ-54**: Фискализация чеков через ОФД.

---

### **15. Интеграции**
- **Обязательные**:
   - Платежные системы: отечественные.
   - Логистика: Почта.
- **Партнеры**: Агрегаторы.

---

## **16. Санкции и импортозамещение**
- **Запрещено**:
   - Использование зарубежных облаков.
   - Иностранные платежные системы.
- **Требуется**:
   - Отечественные аналоги.

---

## 6. **Расчет нагрузки**

### **1. Пользовательский трафик**
### Сценарии использования:
- **Авторы**:
   - Загрузка глав: 50 RPS (пик утром/вечером).
   - Работа с комментариями: 20 RPS.
- **Клиенты**:
   - Просмотр каталога: 500 RPS (пик в выходные, вечер в будние дни).
   - Покупка книг: 150 RPS (распродажа — до 1k RPS).
- **Рецензенты**:
   - Проверка глав: 30 RPS.

### Активные сессии:
- **Среднесуточно**: 10k пользователей онлайн.
- **Пик**: 100k пользователей (релиз популярной книги).

---

### **2. Сетевой трафик**
- **Ежемесячный объем**:
   - Входящий: 5 ТБ (загрузка глав авторами).
   - Исходящий: 150 ТБ (скачивание электронных книг клиентами).
- **Пиковая пропускная способность**:
   - 2 Гбит/с (одновременная доставка новых глав бета-клиентам).

#### Соединения:
- **Одновременные WebSocket**: 5k (для real-time уведомлений авторам).
- **Длительные HTTP-сессии**: 20k (просмотр каталога).

---

### **3. Вычислительная мощность**
### Требования к серверам:
| Компонент           | vCPU | RAM (GB) | Кол-во нод |  
|---------------------|------|----------|------------|  
| **Бэкенд (магазин)** | 16   | 64       | 10         |  
| **Бэкенд (CMS)**     | 8    | 32       | 5          |  
| **СУБД**            | 32   | 128      | 3 (шарды)  |  

### Обработка:
- **Запросы к каталогу**: 5k RPM (Reads Per Minute).
- **Оплата**: 500 TPS (транзакций в секунду, пик — 2k TPS).

---

### **4. Дисковое пространство**
### Текущие данные:
| Тип данных          | Объем (на старте) | Годовой прирост |  
|---------------------|-------------------|-----------------|  
| **Электронные книги** | 50 ТБ             | +200% (150 ТБ)  |  
| **Главы (DOCX/PDF)** | 5 ТБ              | +150% (12.5 ТБ) |  
| **Логи транзакций**  | 1 ТБ/мес          | +50 ГБ/мес      |  

### Особенности хранения:
- **Репликация**: 3 копии всех данных (итого: 3× общий объем).
- **Резервные копии**: Ежедневные резервные копии (хранятся 30 дней).

---

## **Итоговые требования к инфраструктуре**
- **Общее хранилище**: 500 ТБ (первый год, с учетом репликации и бэкапов).
- **Сеть**: 10 Гбит/с канал для обработки пиков.
- **Вычислительные ресурсы**: 320 vCPU, 1.2 ТБ RAM.

--- 
